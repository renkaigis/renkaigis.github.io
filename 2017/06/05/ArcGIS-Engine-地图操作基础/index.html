<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ArcGIS Engine 地图操作基础 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一、数据加载1. 加载地图文档地图文档可以是一个ArcMap文档（*.mxd）或者ArcMap模版（*.mxt）或ArcReader文件（*.pmf）。 加载地图文档的方式有三种：  (1) 使用 IMapControl 接口的 LoadMxFile 方法加载； (2) 通过 IMapDocument 接口加载; (3) 使用 ArcGIS Engine 中封装好的类库资源 ControlsOpe">
<meta property="og:type" content="article">
<meta property="og:title" content="ArcGIS Engine 地图操作基础">
<meta property="og:url" content="http://yoursite.com/2017/06/05/ArcGIS-Engine-地图操作基础/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="一、数据加载1. 加载地图文档地图文档可以是一个ArcMap文档（*.mxd）或者ArcMap模版（*.mxt）或ArcReader文件（*.pmf）。 加载地图文档的方式有三种：  (1) 使用 IMapControl 接口的 LoadMxFile 方法加载； (2) 通过 IMapDocument 接口加载; (3) 使用 ArcGIS Engine 中封装好的类库资源 ControlsOpe">
<meta property="og:updated_time" content="2017-06-05T04:58:37.774Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ArcGIS Engine 地图操作基础">
<meta name="twitter:description" content="一、数据加载1. 加载地图文档地图文档可以是一个ArcMap文档（*.mxd）或者ArcMap模版（*.mxt）或ArcReader文件（*.pmf）。 加载地图文档的方式有三种：  (1) 使用 IMapControl 接口的 LoadMxFile 方法加载； (2) 通过 IMapDocument 接口加载; (3) 使用 ArcGIS Engine 中封装好的类库资源 ControlsOpe">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ArcGIS-Engine-地图操作基础" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/05/ArcGIS-Engine-地图操作基础/" class="article-date">
  <time datetime="2017-06-05T04:47:44.000Z" itemprop="datePublished">2017-06-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ArcGIS Engine 地图操作基础
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、数据加载"><a href="#一、数据加载" class="headerlink" title="一、数据加载"></a>一、数据加载</h2><h3 id="1-加载地图文档"><a href="#1-加载地图文档" class="headerlink" title="1. 加载地图文档"></a>1. 加载地图文档</h3><p>地图文档可以是一个ArcMap文档（*.mxd）或者ArcMap模版（*.mxt）或ArcReader文件（*.pmf）。</p>
<p><strong>加载地图文档的方式有三种：</strong></p>
<ul>
<li>(1) 使用 IMapControl 接口的 LoadMxFile 方法加载；</li>
<li>(2) 通过 IMapDocument 接口加载;</li>
<li>(3) 使用 ArcGIS Engine 中封装好的类库资源 ControlsOpenDocCommandClass 加载。</li>
</ul>
<h4 id="1-1-LoadMxFile-方法加载地图文档文件"><a href="#1-1-LoadMxFile-方法加载地图文档文件" class="headerlink" title="1.1 LoadMxFile 方法加载地图文档文件"></a>1.1 LoadMxFile 方法加载地图文档文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">private void BtnLoadMxFile_Click(object sender, EventArgs e)</div><div class="line">&#123;</div><div class="line">    //加载数据前如果有数据则清空</div><div class="line">    try</div><div class="line">    &#123;</div><div class="line">        OpenFileDialog pOpenFileDialog = new OpenFileDialog();</div><div class="line">        pOpenFileDialog.CheckFileExists = true;</div><div class="line">        pOpenFileDialog.Title = &quot;打开地图文档&quot;;</div><div class="line">        pOpenFileDialog.Filter = &quot;ArcMap文档(*.mxd)|*.mxd;|ArcMap模板(*.mxt)|*.mxt|发布地图文件(*.pmf)|*.pmf|所有地图格式(*.mxd;*.mxt;*.pmf)|*.mxd;*.mxt;*.pmf&quot;;</div><div class="line">        pOpenFileDialog.Multiselect = false;   //不允许多个文件同时选择</div><div class="line">        pOpenFileDialog.RestoreDirectory = true;   //存储打开的文件路径</div><div class="line">        if (pOpenFileDialog.ShowDialog() == DialogResult.OK)</div><div class="line">        &#123;</div><div class="line">            string pFileName = pOpenFileDialog.FileName;</div><div class="line">            if (pFileName == &quot;&quot;)</div><div class="line">            &#123;</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line">            if (mainMapControl.CheckMxFile(pFileName)) //检查地图文档有效性</div><div class="line">            &#123;</div><div class="line">                ClearAllData();</div><div class="line">                mainMapControl.LoadMxFile(pFileName);</div><div class="line">            &#125;</div><div class="line">            else</div><div class="line">            &#123;</div><div class="line">                MessageBox.Show(pFileName + &quot;是无效的地图文档!&quot;, &quot;信息提示&quot;);</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    catch (Exception ex)</div><div class="line">    &#123;</div><div class="line">        MessageBox.Show(&quot;打开地图文档失败&quot; + ex.Message);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>关于 ClearAllData 函数:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">private void ClearAllData()</div><div class="line">&#123;</div><div class="line">    if (mainMapControl.Map != null &amp;&amp; mainMapControl.Map.LayerCount &gt; 0)</div><div class="line">    &#123;</div><div class="line">        //新建mainMapControl中Map</div><div class="line">        IMap dataMap = new MapClass();</div><div class="line">        dataMap.Name = &quot;Map&quot;;</div><div class="line">        mainMapControl.DocumentFilename = string.Empty;</div><div class="line">        mainMapControl.Map = dataMap;</div><div class="line"></div><div class="line">        //新建EagleEyeMapControl中Map</div><div class="line">        IMap eagleEyeMap = new MapClass();</div><div class="line">        eagleEyeMap.Name = &quot;eagleEyeMap&quot;;</div><div class="line">        EagleEyeMapControl.DocumentFilename = string.Empty;</div><div class="line">        EagleEyeMapControl.Map = eagleEyeMap;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="1-2-IMapDocument-方法加载-Mxd-文档文件"><a href="#1-2-IMapDocument-方法加载-Mxd-文档文件" class="headerlink" title="1.2 IMapDocument 方法加载 Mxd 文档文件"></a>1.2 IMapDocument 方法加载 Mxd 文档文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">private void BtnIMapDocument_Click(object sender, EventArgs e)</div><div class="line">&#123;</div><div class="line">    try</div><div class="line">    &#123;</div><div class="line">        OpenFileDialog pOpenFileDialog = new OpenFileDialog();</div><div class="line">        pOpenFileDialog.CheckFileExists = true;</div><div class="line">        pOpenFileDialog.Title = &quot;打开地图文档&quot;;</div><div class="line">        pOpenFileDialog.Filter = &quot;ArcMap文档(*.mxd)|*.mxd;|ArcMap模板(*.mxt)|*.mxt|发布地图文件(*.pmf)|*.pmf|所有地图格式(*.mxd;*.mxt;*.pmf)|*.mxd;*.mxt;*.pmf&quot;;</div><div class="line">        pOpenFileDialog.Multiselect = false;</div><div class="line">        pOpenFileDialog.RestoreDirectory = true;</div><div class="line">        if (pOpenFileDialog.ShowDialog() == DialogResult.OK)</div><div class="line">        &#123;</div><div class="line">            string pFileName = pOpenFileDialog.FileName;</div><div class="line">            if (pFileName == &quot;&quot;)</div><div class="line">            &#123;</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if (mainMapControl.CheckMxFile(pFileName)) //检查地图文档有效性</div><div class="line">            &#123;</div><div class="line">                //将数据载入pMapDocument并与Map控件关联</div><div class="line">                IMapDocument pMapDocument = new MapDocument();//using ESRI.ArcGIS.Carto;</div><div class="line">                pMapDocument.Open(pFileName, &quot;&quot;);</div><div class="line">                //获取Map中激活的地图文档</div><div class="line">                mainMapControl.Map = pMapDocument.ActiveView.FocusMap;</div><div class="line">                mainMapControl.ActiveView.Refresh();</div><div class="line">            &#125;</div><div class="line">            else</div><div class="line">            &#123;</div><div class="line">                MessageBox.Show(pFileName + &quot;是无效的地图文档!&quot;, &quot;信息提示&quot;);</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    catch (Exception ex)</div><div class="line">    &#123;</div><div class="line">        MessageBox.Show(&quot;打开地图文档失败&quot; + ex.Message);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="1-3-ControlsOpenDocCommandClass-加载地图"><a href="#1-3-ControlsOpenDocCommandClass-加载地图" class="headerlink" title="1.3 ControlsOpenDocCommandClass 加载地图"></a>1.3 ControlsOpenDocCommandClass 加载地图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">private void BtncontrolsOpenDocCommandClass_Click(object sender, EventArgs e)</div><div class="line">&#123;</div><div class="line">    ICommand command = new ControlsOpenDocCommandClass();</div><div class="line">    command.OnCreate(mainMapControl.Object);</div><div class="line">    command.OnClick();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-加载-Shapefile-数据"><a href="#2-加载-Shapefile-数据" class="headerlink" title="2. 加载 Shapefile 数据"></a>2. 加载 Shapefile 数据</h3><p>加载 Shapefile 数据的方式有两种：</p>
<ul>
<li><ol>
<li>通过工作空间加载；</li>
</ol>
</li>
<li><ol>
<li>通过 MapControl 空间的 AddShapefile 方法加载</li>
</ol>
</li>
</ul>
<h4 id="2-1-通过工作空间加载"><a href="#2-1-通过工作空间加载" class="headerlink" title="2.1 通过工作空间加载"></a>2.1 通过工作空间加载</h4><p><strong>实例程序实现思路：</strong></p>
<ul>
<li>(1) 创建 ShapefileWorkspaceFactory 实例 pWorkspaceFactory ，使用 IWorkspaceFactory 接口的 OpenFromFile 方法打开 pFeatureWorkspace 中存储的基于 Shapefile 的工作区。</li>
<li>(2) 创建 FeatureLayer 的实例 pFeatureLayer ，并定义数据集。</li>
<li>(3) 使用 IMap 接口的 AddLayer 方法加载 pFeatureLayer 到当前地图。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">private void AddShp_Click(object sender, EventArgs e)</div><div class="line">&#123;</div><div class="line">    //ClearAllData();</div><div class="line">    try</div><div class="line">    &#123;</div><div class="line">        OpenFileDialog pOpenFileDialog = new OpenFileDialog();</div><div class="line">        pOpenFileDialog.CheckFileExists = true;</div><div class="line">        pOpenFileDialog.Title = &quot;打开Shape文件&quot;;</div><div class="line">        pOpenFileDialog.Filter = &quot;Shape文件（*.shp）|*.shp&quot;;</div><div class="line">        pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">        ////获取文件路径,此即为第二种方法</div><div class="line">        //FileInfo pFileInfo = new FileInfo(pOpenFileDialog.FileName);</div><div class="line">        //string pPath = pOpenFileDialog.FileName.Substring(0, pOpenFileDialog.FileName.Length - pFileInfo.Name.Length);</div><div class="line">        //mainMapControl.AddShapeFile(pPath, pFileInfo.Name);</div><div class="line"></div><div class="line">        // 获取文件路径</div><div class="line">        IWorkspaceFactory pWorkspaceFactory;</div><div class="line">        IFeatureWorkspace pFeatureWorkspace;</div><div class="line">        IFeatureLayer pFeatureLayer;</div><div class="line"></div><div class="line">        string pFullPath = pOpenFileDialog.FileName;</div><div class="line">        if (pFullPath == &quot;&quot;)</div><div class="line">            return;</div><div class="line"></div><div class="line">        int pIndex = pFullPath.LastIndexOf(&quot;\\&quot;);</div><div class="line">        //lastIndexOf是从字符串末尾开始检索，检索到子字符，则返回子字符在字符串中的位置，（位置从前向后数，最小位为0，也就是从第0位开始算起）未检测到则返回-1。</div><div class="line">        string pFilePath = pFullPath.Substring(0, pIndex); //文件路径</div><div class="line">        string pFileName = pFullPath.Substring(pIndex + 1); //文件名</div><div class="line">        /*substring(参数)是java中截取字符串的一个方法</div><div class="line">        有两种传参方式</div><div class="line">        一种是 public String substring(int beginIndex)</div><div class="line">        返回一个新的字符串，它是此字符串的一个子字符串。该子字符串从指定索引处的字符开始，直到此字符串末尾。</div><div class="line">        另一种是 public String substring(int beginIndex, int endIndex)</div><div class="line">        返回一个新字符串，它是此字符串的一个子字符串。该子字符串从指定的 beginIndex 处开始，直到索引 endIndex - 1 处的字符。因此，该子字符串的长度为 endIndex-beginIndex。 */</div><div class="line"></div><div class="line">        //实例化ShapefileWorkspaceFactory工作空间，打开Shape文件</div><div class="line">        pWorkspaceFactory = new ShapefileWorkspaceFactory();</div><div class="line">        pFeatureWorkspace = (IFeatureWorkspace)pWorkspaceFactory.OpenFromFile(pFilePath, 0);</div><div class="line">        //创建并实例化要素集</div><div class="line">        IFeatureClass pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName);</div><div class="line">        pFeatureLayer = new FeatureLayer();</div><div class="line">        pFeatureLayer.FeatureClass = pFeatureClass;</div><div class="line">        pFeatureLayer.Name = pFeatureLayer.FeatureClass.AliasName;//获取别名</div><div class="line"></div><div class="line">        ClearAllData();    //新增删除数据</div><div class="line"></div><div class="line">        mainMapControl.Map.AddLayer(pFeatureLayer);//加载图层</div><div class="line">        mainMapControl.ActiveView.Refresh();</div><div class="line">        //同步鹰眼.可有可无</div><div class="line">        SynchronizeEagleEye();</div><div class="line">    &#125;</div><div class="line">    catch (Exception ex)</div><div class="line">    &#123;</div><div class="line">        MessageBox.Show(&quot;图层加载失败！&quot; + ex.Message);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-2-通过-MapControl-空间的-AddShapefile-方法加载"><a href="#2-2-通过-MapControl-空间的-AddShapefile-方法加载" class="headerlink" title="2.2 通过 MapControl 空间的 AddShapefile 方法加载"></a>2.2 通过 MapControl 空间的 AddShapefile 方法加载</h4><blockquote>
<p>调用该方法需要传入两个参数，分别是文件路径和不带扩展名的文件名。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">private void AddShp2_Click(object sender, EventArgs e)</div><div class="line">&#123;</div><div class="line">    OpenFileDialog pOpenFileDialog = new OpenFileDialog();</div><div class="line">    pOpenFileDialog.CheckFileExists = true;</div><div class="line">    pOpenFileDialog.Title = &quot;打开Shape文件&quot;;</div><div class="line">    pOpenFileDialog.Filter = &quot;Shape文件（*.shp）|*.shp&quot;;</div><div class="line">    pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">    //获取文件路径</div><div class="line">    FileInfo pFileInfo = new FileInfo(pOpenFileDialog.FileName);//FileInfo需要using system.IO</div><div class="line">    string pPath = pOpenFileDialog.FileName.Substring(0, pOpenFileDialog.FileName.Length - pFileInfo.Name.Length);</div><div class="line">    mainMapControl.AddShapeFile(pPath, pFileInfo.Name);</div><div class="line">    // 调用该方法需要传入两个参数，分别是文件路径和不带扩展名的文件名。</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-加载栅格数据"><a href="#2-加载栅格数据" class="headerlink" title="2. 加载栅格数据"></a>2. 加载栅格数据</h3><p><strong>实例程序实现思路：</strong></p>
<p>在加载栅格文件时，需引用 ESRI.ArcGIS.DataSourcesRaster 命名空间。</p>
<ul>
<li>(1) 用 IWorkspaceFactory 接口的 OpenFromFile 方法获得栅格文件的工作区； </li>
<li>(2) 用 IRasterWorkspace 接口的 OpenRasterDataset 方法获得栅格文件的数据集，实例化栅格文件对象，并对栅格数据集是否具有金字塔进行判断（这里栅格文件如果不具有金字塔则创建金字塔，可以提高大数据量图像的显示效率）；</li>
<li>(3) 创建 RasterLayer 类的实例 pRasterLayer ，并定义其数据集；</li>
<li>(4) 使用 MapControl 控件的 AllLayer 方法将 pRasterLayer 添加至当前地图。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">private void AddRaster_Click(object sender, EventArgs e)</div><div class="line">&#123;</div><div class="line">    OpenFileDialog pOpenFileDialog = new OpenFileDialog();</div><div class="line">    pOpenFileDialog.CheckFileExists = true;</div><div class="line">    pOpenFileDialog.Title = &quot;打开Raster文件&quot;;</div><div class="line">    pOpenFileDialog.Filter = &quot;栅格文件 (*.*)|*.bmp;*.tif;*.jpg;*.img|(*.bmp)|*.bmp|(*.tif)|*.tif|(*.jpg)|*.jpg|(*.img)|*.img&quot;;</div><div class="line">    pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">    string pRasterFileName = pOpenFileDialog.FileName;</div><div class="line">    if (pRasterFileName == &quot;&quot;)</div><div class="line">    &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    string pPath = System.IO.Path.GetDirectoryName(pRasterFileName);</div><div class="line">    string pFileName = System.IO.Path.GetFileName(pRasterFileName);</div><div class="line"></div><div class="line">    IWorkspaceFactory pWorkspaceFactory = new RasterWorkspaceFactory();</div><div class="line">    IWorkspace pWorkspace = pWorkspaceFactory.OpenFromFile(pPath, 0);</div><div class="line">    IRasterWorkspace pRasterWorkspace = pWorkspace as IRasterWorkspace;</div><div class="line">    IRasterDataset pRasterDataset = pRasterWorkspace.OpenRasterDataset(pFileName);</div><div class="line">    //影像金字塔判断与创建</div><div class="line">    IRasterPyramid3 pRasPyrmid;</div><div class="line">    pRasPyrmid = pRasterDataset as IRasterPyramid3;</div><div class="line">    if (pRasPyrmid != null)</div><div class="line">    &#123;</div><div class="line">        if (!(pRasPyrmid.Present))</div><div class="line">        &#123;</div><div class="line">            pRasPyrmid.Create(); //创建金字塔</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    IRaster pRaster;</div><div class="line">    pRaster = pRasterDataset.CreateDefaultRaster();</div><div class="line">    IRasterLayer pRasterLayer;</div><div class="line">    pRasterLayer = new RasterLayerClass();</div><div class="line">    pRasterLayer.CreateFromRaster(pRaster);</div><div class="line">    mainMapControl.Map.AddLayer(pLayer);//加载shp文件时是这样弄得，经过尝试这样也是可以的，具体有什么区别不可知</div><div class="line">    //mainMapControl.AddLayer(pLayer, 0);//这是书上的源代码</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-加载-CAD-数据"><a href="#3-加载-CAD-数据" class="headerlink" title="3. 加载 CAD 数据"></a>3. 加载 CAD 数据</h3><p>对于 ArcGIS Engine 来说，有两种不同的方式使用 CAD 数据：① 作为要素图层，以矢量数据来使用；② 作为地图背景，以栅格数据来使用。对于前者， ArcGIS Engine 使用与 FeatureLayer 一样的方法来管理，对于后者则采用 CadLayer 对象来管理。</p>
<h4 id="3-1-CAD-文件作为矢量图层加载"><a href="#3-1-CAD-文件作为矢量图层加载" class="headerlink" title="3.1 CAD 文件作为矢量图层加载"></a>3.1 CAD 文件作为矢量图层加载</h4><h5 id="3-1-1-分图层加载"><a href="#3-1-1-分图层加载" class="headerlink" title="3.1.1 分图层加载"></a>3.1.1 分图层加载</h5><p><strong>实例程序实现思路：</strong></p>
<ul>
<li>(1) CAD 图可以分为点、线、面、标注，它们可以分别被加载到 MapControl 中。与加载其他数据一样，首先定义一个工作空间，用 CadWorkspaceFactoryClass 实例化工作空间，并打开相应的工作空间； </li>
<li>(2) 创建 FeatureLayer 的实例，定义数据集，使用 IMap 接口的 AddLayer 方法将要素图层添加至当前地图。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">private void AddCADByLayer_Click(object sender, EventArgs e)</div><div class="line">&#123;</div><div class="line">    IWorkspaceFactory pWorkspaceFactory;</div><div class="line">    IFeatureWorkspace pFeatureWorkspace;</div><div class="line">    IFeatureLayer pFeatureLayer;</div><div class="line">    IFeatureClass pFeatureClass;</div><div class="line"></div><div class="line">    OpenFileDialog pOpenFileDialog = new OpenFileDialog();</div><div class="line">    pOpenFileDialog.Filter = &quot;CAD(*.dwg)|*.dwg&quot;;</div><div class="line">    pOpenFileDialog.Title = &quot;打开CAD数据文件&quot;;</div><div class="line">    pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">    string pFullPath = pOpenFileDialog.FileName;</div><div class="line">    if (pFullPath == &quot;&quot;)</div><div class="line">    &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    //获取文件名和文件路径</div><div class="line">    int pIndex = pFullPath.LastIndexOf(&quot;\\&quot;);</div><div class="line">    string pFilePath = pFullPath.Substring(0, pIndex);</div><div class="line">    string pFileName = pFullPath.Substring(pIndex + 1);</div><div class="line"></div><div class="line">    pWorkspaceFactory = new CadWorkspaceFactory();</div><div class="line">    pFeatureWorkspace = (IFeatureWorkspace)pWorkspaceFactory.OpenFromFile(pFilePath, 0);</div><div class="line">    //加载CAD文件中的线文件</div><div class="line">    pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName + &quot;:polyline&quot;);</div><div class="line">    //pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName + &quot;:polygon&quot;);//打开多边形</div><div class="line">    //pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName + &quot;:point&quot;);//打开点</div><div class="line">    //pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName + &quot;:multipatch&quot;);//打开多面体</div><div class="line">    //pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName + &quot;:annotation&quot;);//打开标注是这样吗？自己尝试失败，打开的是点，什么鬼？搞不懂。。。</div><div class="line">    pFeatureLayer = new FeatureLayerClass();</div><div class="line">    pFeatureLayer.Name = pFileName;</div><div class="line">    pFeatureLayer.FeatureClass = pFeatureClass;</div><div class="line"></div><div class="line">    ClearAllData();    //新增删除数据</div><div class="line"></div><div class="line">    mainMapControl.Map.AddLayer(pFeatureLayer);</div><div class="line">    mainMapControl.ActiveView.Refresh();</div><div class="line">    //同步鹰眼，可有可无</div><div class="line">    SynchronizeEagleEye();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="3-1-2-整幅图加载"><a href="#3-1-2-整幅图加载" class="headerlink" title="3.1.2 整幅图加载"></a>3.1.2 整幅图加载</h5><p><strong>实例程序实现思路：</strong></p>
<ul>
<li>将 CAD 作为整幅图加载时，在得到相应的工作空间之后对 CAD 文件中的要素进行遍历，并判断是否为注记图层，如果是注记则需要使用 CadAnnotationLayer 对象。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">private void AddWholeCAD_Click(object sender, EventArgs e)</div><div class="line">&#123;</div><div class="line">    IWorkspaceFactory pWorkspaceFactory;</div><div class="line">    IFeatureWorkspace pFeatureWorkspace;</div><div class="line">    IFeatureLayer pFeatureLayer;</div><div class="line">    IFeatureDataset pFeatureDataset;</div><div class="line"></div><div class="line">    OpenFileDialog pOpenFileDialog = new OpenFileDialog();</div><div class="line">    pOpenFileDialog.Filter = &quot;CAD(*.dwg)|*.dwg&quot;;</div><div class="line">    pOpenFileDialog.Title = &quot;打开CAD数据文件&quot;;</div><div class="line">    pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">    string pFullPath = pOpenFileDialog.FileName;</div><div class="line">    if (pFullPath == &quot;&quot;)</div><div class="line">    &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    //获取文件名和文件路径</div><div class="line">    int pIndex = pFullPath.LastIndexOf(&quot;\\&quot;);</div><div class="line">    string pFilePath = pFullPath.Substring(0, pIndex);</div><div class="line">    string pFileName = pFullPath.Substring(pIndex + 1);</div><div class="line">    //打开CAD数据集</div><div class="line">    pWorkspaceFactory = new CadWorkspaceFactoryClass(); //using ESRI.ArcGIS.DataSourcesFile;</div><div class="line">    pFeatureWorkspace = (IFeatureWorkspace)pWorkspaceFactory.OpenFromFile(pFilePath, 0);</div><div class="line">    //打开一个要素集</div><div class="line">    pFeatureDataset = pFeatureWorkspace.OpenFeatureDataset(pFileName);</div><div class="line">    //IFeatureClassContainer可以管理IFeatureDataset中的每个要素类</div><div class="line">    IFeatureClassContainer pFeatClassContainer = (IFeatureClassContainer)pFeatureDataset;</div><div class="line"></div><div class="line">    ClearAllData();    //新增删除数据</div><div class="line"></div><div class="line">    //对CAD文件中的要素进行遍历处理</div><div class="line">    for (int i = 0; i &lt; pFeatClassContainer.ClassCount; i++)</div><div class="line">    &#123;</div><div class="line">        IFeatureClass pFeatClass = pFeatClassContainer.get_Class(i);</div><div class="line">        //如果是注记，则添加注记层</div><div class="line">        if (pFeatClass.FeatureType == esriFeatureType.esriFTCoverageAnnotation)</div><div class="line">        &#123;</div><div class="line">            pFeatureLayer = new CadAnnotationLayerClass();</div><div class="line">            pFeatureLayer.Name = pFeatClass.AliasName;</div><div class="line">            pFeatureLayer.FeatureClass = pFeatClass;</div><div class="line">            mainMapControl.Map.AddLayer(pFeatureLayer);</div><div class="line">        &#125;</div><div class="line">        else //如果是点、线、面则添加要素层</div><div class="line">        &#123;</div><div class="line">            pFeatureLayer = new FeatureLayerClass();</div><div class="line">            pFeatureLayer.Name = pFeatClass.AliasName;</div><div class="line">            pFeatureLayer.FeatureClass = pFeatClass;</div><div class="line">            mainMapControl.Map.AddLayer(pFeatureLayer);</div><div class="line">        &#125;</div><div class="line">        mainMapControl.ActiveView.Refresh();</div><div class="line">    &#125;</div><div class="line">    //同步鹰眼，可有可无</div><div class="line">    SynchronizeEagleEye();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-2-CAD-文件作为栅格图层加载"><a href="#3-2-CAD-文件作为栅格图层加载" class="headerlink" title="3.2 CAD 文件作为栅格图层加载"></a>3.2 CAD 文件作为栅格图层加载</h4><p><strong>实例程序实现思路：</strong></p>
<ul>
<li>(1) 用 IWorkspaceFactory 接口的 OpenFromFile 方法获得 CAD 文件的工作区； </li>
<li>(2) 用 ICadDrawingWorkspace 接口的 OpenCadDrawingDataset 方法获得 CAD 文件的数据集，并将其赋值给 CadLayerClass 类的实例对象 pCadLayer 的 CadDrawingDataset 属性；</li>
<li>(3) 使用 IMap 接口的 AddLayer 方法将 pCadLayer 添加至当前地图。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">private void AddRasterByCAD_Click(object sender, EventArgs e)</div><div class="line">&#123;</div><div class="line">    IWorkspaceFactory pCadWorkspaceFactory;</div><div class="line">    IWorkspace pWorkspace;</div><div class="line">    ICadDrawingWorkspace pCadDrawingWorkspace;</div><div class="line">    ICadDrawingDataset pCadDrawingDataset;</div><div class="line">    ICadLayer pCadLayer;</div><div class="line"></div><div class="line">    OpenFileDialog pOpenFileDialog = new OpenFileDialog();</div><div class="line">    pOpenFileDialog.Filter = &quot;CAD(*.dwg)|*.dwg&quot;;</div><div class="line">    pOpenFileDialog.Title = &quot;打开CAD数据文件&quot;;</div><div class="line">    pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">    string pFullPath = pOpenFileDialog.FileName;</div><div class="line">    if (pFullPath == &quot;&quot;)</div><div class="line">    &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    //获取文件名和文件路径</div><div class="line">    int pIndex = pFullPath.LastIndexOf(&quot;\\&quot;);</div><div class="line">    string pFilePath = pFullPath.Substring(0, pIndex);</div><div class="line">    string pFileName = pFullPath.Substring(pIndex + 1);</div><div class="line">    pCadWorkspaceFactory = new CadWorkspaceFactoryClass();</div><div class="line"></div><div class="line">    pWorkspace = pCadWorkspaceFactory.OpenFromFile(pFilePath, 0);</div><div class="line">    pCadDrawingWorkspace = (ICadDrawingWorkspace)pWorkspace;</div><div class="line">    //获得CAD文件的数据集</div><div class="line">    pCadDrawingDataset = pCadDrawingWorkspace.OpenCadDrawingDataset(pFileName);</div><div class="line">    pCadLayer = new CadLayerClass();</div><div class="line">    pCadLayer.CadDrawingDataset = pCadDrawingDataset;</div><div class="line">    pCadLayer.Name = pFileName;//书中代码没有这一句，打开的结果是TOC面板里面没有文件的名字，故而自己添上了这一句</div><div class="line"></div><div class="line">    mainMapControl.Map.AddLayer(pCadLayer);</div><div class="line">    mainMapControl.ActiveView.Refresh();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-加载个人地理数据库"><a href="#4-加载个人地理数据库" class="headerlink" title="4. 加载个人地理数据库"></a>4. 加载个人地理数据库</h3><p><strong>实例程序实现思路：</strong></p>
<ul>
<li>(1) 创建 AccessWorkspaceFactory 类的实例； </li>
<li>(2) 用 IWorkspaceFactory 接口的 OpenFromFile 方法打开 *.mdb 数据集的工作空间，对工作空间里面的数据进行加载。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">private void AddPersonGDB_Click(object sender, EventArgs e)</div><div class="line">&#123;</div><div class="line">    IWorkspaceFactory pAccessWorkspaceFactory;</div><div class="line"></div><div class="line">    OpenFileDialog pOpenFileDialog = new OpenFileDialog();</div><div class="line">    pOpenFileDialog.Filter = &quot;Personal Geodatabase(*.mdb)|*.mdb&quot;;</div><div class="line">    pOpenFileDialog.Title = &quot;打开PersonGeodatabase文件&quot;;</div><div class="line">    pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">    string pFullPath = pOpenFileDialog.FileName;</div><div class="line">    if (pFullPath == &quot;&quot;)</div><div class="line">    &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    pAccessWorkspaceFactory = new AccessWorkspaceFactory(); //using ESRI.ArcGIS.DataSourcesGDB;</div><div class="line">    //获取工作空间</div><div class="line">    IWorkspace pWorkspace = pAccessWorkspaceFactory.OpenFromFile(pFullPath, 0);</div><div class="line"></div><div class="line">    ClearAllData();    //新增删除数据</div><div class="line"></div><div class="line">    //加载工作空间里的数据</div><div class="line">    AddAllDataset(pWorkspace, mainMapControl);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>这里对加载工作空间中数据的方法进行了封装，自定义了 AddAllDataset 函数，以便对其他空间数据库（文件地理数据库、ArcSDE 空间数据库）加载时可直接调用。</li>
<li>以上代码主要介绍矢量和栅格数据的加载（其实不止这两种数据格式，加载其他类型的数据也是采用相同的方法，只是采用不同的工作空间而已）。</li>
<li>自定义函数 AddAllDataset 核心代码如下:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">/// &lt;summary&gt;</div><div class="line">/// 加载工作空间里面的要素和栅格数据</div><div class="line">/// &lt;/summary&gt;</div><div class="line">/// &lt;param name=&quot;pWorkspace&quot;&gt;&lt;/param&gt;</div><div class="line">private void AddAllDataset(IWorkspace pWorkspace, AxMapControl mapControl)</div><div class="line">&#123;</div><div class="line">    IEnumDataset pEnumDataset = pWorkspace.get_Datasets(ESRI.ArcGIS.Geodatabase.esriDatasetType.esriDTAny);</div><div class="line">    pEnumDataset.Reset();</div><div class="line">    //将Enum数据集中的数据一个个读到DataSet中</div><div class="line">    IDataset pDataset = pEnumDataset.Next();</div><div class="line">    //判断数据集是否有数据</div><div class="line">    while (pDataset != null)</div><div class="line">    &#123;</div><div class="line">        if (pDataset is IFeatureDataset)  //要素数据集</div><div class="line">        &#123;</div><div class="line">            IFeatureWorkspace pFeatureWorkspace = (IFeatureWorkspace)pWorkspace;</div><div class="line">            IFeatureDataset pFeatureDataset = pFeatureWorkspace.OpenFeatureDataset(pDataset.Name);</div><div class="line">            IEnumDataset pEnumDataset1 = pFeatureDataset.Subsets;</div><div class="line">            pEnumDataset1.Reset();</div><div class="line">            IGroupLayer pGroupLayer = new GroupLayerClass();</div><div class="line">            pGroupLayer.Name = pFeatureDataset.Name;</div><div class="line">            IDataset pDataset1 = pEnumDataset1.Next();</div><div class="line">            while (pDataset1 != null)</div><div class="line">            &#123;</div><div class="line">                if (pDataset1 is IFeatureClass)  //要素类</div><div class="line">                &#123;</div><div class="line">                    IFeatureLayer pFeatureLayer = new FeatureLayerClass();</div><div class="line">                    pFeatureLayer.FeatureClass = pFeatureWorkspace.OpenFeatureClass(pDataset1.Name);</div><div class="line">                    if (pFeatureLayer.FeatureClass != null)</div><div class="line">                    &#123;</div><div class="line">                        pFeatureLayer.Name = pFeatureLayer.FeatureClass.AliasName;</div><div class="line">                        pGroupLayer.Add(pFeatureLayer);</div><div class="line">                        mapControl.Map.AddLayer(pFeatureLayer);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                pDataset1 = pEnumDataset1.Next();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        else if (pDataset is IFeatureClass) //要素类</div><div class="line">        &#123;</div><div class="line">            IFeatureWorkspace pFeatureWorkspace = (IFeatureWorkspace)pWorkspace;</div><div class="line">            IFeatureLayer pFeatureLayer = new FeatureLayerClass();</div><div class="line">            pFeatureLayer.FeatureClass = pFeatureWorkspace.OpenFeatureClass(pDataset.Name);</div><div class="line"></div><div class="line">            pFeatureLayer.Name = pFeatureLayer.FeatureClass.AliasName;</div><div class="line">            mapControl.Map.AddLayer(pFeatureLayer);</div><div class="line">        &#125;</div><div class="line">        else if (pDataset is IRasterDataset) //栅格数据集</div><div class="line">        &#123;</div><div class="line">            IRasterWorkspaceEx pRasterWorkspace = (IRasterWorkspaceEx)pWorkspace;</div><div class="line">            IRasterDataset pRasterDataset = pRasterWorkspace.OpenRasterDataset(pDataset.Name);</div><div class="line">            //影像金字塔判断与创建</div><div class="line">            IRasterPyramid3 pRasPyrmid;</div><div class="line">            pRasPyrmid = pRasterDataset as IRasterPyramid3;</div><div class="line">            if (pRasPyrmid != null)</div><div class="line">            &#123;</div><div class="line">                if (!(pRasPyrmid.Present))</div><div class="line">                &#123;</div><div class="line">                    pRasPyrmid.Create(); //创建金字塔</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            IRasterLayer pRasterLayer = new RasterLayerClass();</div><div class="line">            pRasterLayer.CreateFromDataset(pRasterDataset);</div><div class="line">            ILayer pLayer = pRasterLayer as ILayer;</div><div class="line">            mapControl.AddLayer(pLayer, 0);</div><div class="line">        &#125;</div><div class="line">        pDataset = pEnumDataset.Next();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    mapControl.ActiveView.Refresh();</div><div class="line">    //同步鹰眼</div><div class="line">    SynchronizeEagleEye();</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/05/ArcGIS-Engine-地图操作基础/" data-id="cj3jk0u1q0001w8rughcz4c6i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2017/06/05/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/06/05/ArcGIS-Engine-地图操作基础/">ArcGIS Engine 地图操作基础</a>
          </li>
        
          <li>
            <a href="/2017/06/05/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 RenKai<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>