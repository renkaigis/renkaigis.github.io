<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[测试：《雨巷》]]></title>
      <url>/2017/06/05/%E6%B5%8B%E8%AF%95%EF%BC%9A%E3%80%8A%E9%9B%A8%E5%B7%B7%E3%80%8B/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="雨巷"><a href="#雨巷" class="headerlink" title="雨巷"></a>雨巷</h2><h4 id="戴望舒"><a href="#戴望舒" class="headerlink" title="戴望舒"></a>戴望舒</h4><p><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1496668641643&amp;di=e29c6f03c2b2979eacb3fd64fb896d4c&amp;imgtype=0&amp;src=http%3A%2F%2Fs4.sinaimg.cn%2Fmiddle%2F62302a9dgb669507fe5e3%26690" alt="雨巷"><br>撑着油纸伞，独自<br>彷徨在悠长，悠长<br>又寂寥的雨巷，<br>我希望逢着<br>一个丁香一样的<br>结着愁怨的姑娘。<br>她是有<br>丁香一样的颜色，<br>丁香一样的芬芳，<br>丁香一样的忧愁，<br>在雨中哀怨，<br>哀怨又彷徨；<br>她彷徨在这寂寥的雨巷，<br>撑着油纸伞<br>像我一样，<br>像我一样地<br>默默彳亍着，<br>冷漠，凄清，又惆怅。<br>她静默地走近<br>走近，又投出<br>太息一般的眼光，<br>她飘过<br>像梦一般的，<br>像梦一般的凄婉迷茫。<br>像梦中飘过<br>一枝丁香的，<br>我身旁飘过这女郎；<br>她静默地远了，远了，<br>到了颓圮的篱墙，<br>走尽这雨巷。<br>在雨的哀曲里，<br>消了她的颜色，<br>散了她的芬芳<br>消散了，甚至她的<br>太息般的眼光，<br>丁香般的惆怅。<br>撑着油纸伞，独自<br>彷徨在悠长，悠长<br>又寂寥的雨巷，<br>我希望飘过<br>一个丁香一样的<br>结着愁怨的姑娘。</p>
]]></content>
      
        <categories>
            
            <category> 随笔 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ArcGIS Engine 地图操作基础]]></title>
      <url>/2017/06/05/ArcGIS-Engine-%E5%9C%B0%E5%9B%BE%E6%93%8D%E4%BD%9C%E5%9F%BA%E7%A1%80/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="一、数据加载"><a href="#一、数据加载" class="headerlink" title="一、数据加载"></a>一、数据加载</h2><h3 id="1-加载地图文档"><a href="#1-加载地图文档" class="headerlink" title="1. 加载地图文档"></a>1. 加载地图文档</h3><p>地图文档可以是一个ArcMap文档（*.mxd）或者ArcMap模版（*.mxt）或ArcReader文件（*.pmf）。</p>
<p><strong>加载地图文档的方式有三种：</strong></p>
<ul>
<li>(1) 使用 IMapControl 接口的 LoadMxFile 方法加载；</li>
<li>(2) 通过 IMapDocument 接口加载;</li>
<li>(3) 使用 ArcGIS Engine 中封装好的类库资源 ControlsOpenDocCommandClass 加载。</li>
</ul>
<h4 id="1-1-LoadMxFile-方法加载地图文档文件"><a href="#1-1-LoadMxFile-方法加载地图文档文件" class="headerlink" title="1.1 LoadMxFile 方法加载地图文档文件"></a>1.1 LoadMxFile 方法加载地图文档文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">BtnLoadMxFile_Click</span><span class="params">(object sender, EventArgs e)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//加载数据前如果有数据则清空</span></div><div class="line">    <span class="keyword">try</span></div><div class="line">    &#123;</div><div class="line">        OpenFileDialog pOpenFileDialog = <span class="keyword">new</span> OpenFileDialog();</div><div class="line">        pOpenFileDialog.CheckFileExists = <span class="keyword">true</span>;</div><div class="line">        pOpenFileDialog.Title = <span class="string">"打开地图文档"</span>;</div><div class="line">        pOpenFileDialog.Filter = <span class="string">"ArcMap文档(*.mxd)|*.mxd;|ArcMap模板(*.mxt)|*.mxt|发布地图文件(*.pmf)|*.pmf|所有地图格式(*.mxd;*.mxt;*.pmf)|*.mxd;*.mxt;*.pmf"</span>;</div><div class="line">        pOpenFileDialog.Multiselect = <span class="keyword">false</span>;   <span class="comment">//不允许多个文件同时选择</span></div><div class="line">        pOpenFileDialog.RestoreDirectory = <span class="keyword">true</span>;   <span class="comment">//存储打开的文件路径</span></div><div class="line">        <span class="keyword">if</span> (pOpenFileDialog.ShowDialog() == DialogResult.OK)</div><div class="line">        &#123;</div><div class="line">            string pFileName = pOpenFileDialog.FileName;</div><div class="line">            <span class="keyword">if</span> (pFileName == <span class="string">""</span>)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (mainMapControl.CheckMxFile(pFileName)) <span class="comment">//检查地图文档有效性</span></div><div class="line">            &#123;</div><div class="line">                ClearAllData();</div><div class="line">                mainMapControl.LoadMxFile(pFileName);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span></div><div class="line">            &#123;</div><div class="line">                MessageBox.Show(pFileName + <span class="string">"是无效的地图文档!"</span>, <span class="string">"信息提示"</span>);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">catch</span> (Exception ex)</div><div class="line">    &#123;</div><div class="line">        MessageBox.Show(<span class="string">"打开地图文档失败"</span> + ex.Message);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>关于 ClearAllData 函数:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ClearAllData</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (mainMapControl.Map != <span class="keyword">null</span> &amp;&amp; mainMapControl.Map.LayerCount &gt; <span class="number">0</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="comment">//新建mainMapControl中Map</span></div><div class="line">        IMap dataMap = <span class="keyword">new</span> MapClass();</div><div class="line">        dataMap.Name = <span class="string">"Map"</span>;</div><div class="line">        mainMapControl.DocumentFilename = string.Empty;</div><div class="line">        mainMapControl.Map = dataMap;</div><div class="line"></div><div class="line">        <span class="comment">//新建EagleEyeMapControl中Map</span></div><div class="line">        IMap eagleEyeMap = <span class="keyword">new</span> MapClass();</div><div class="line">        eagleEyeMap.Name = <span class="string">"eagleEyeMap"</span>;</div><div class="line">        EagleEyeMapControl.DocumentFilename = string.Empty;</div><div class="line">        EagleEyeMapControl.Map = eagleEyeMap;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="1-2-IMapDocument-方法加载-Mxd-文档文件"><a href="#1-2-IMapDocument-方法加载-Mxd-文档文件" class="headerlink" title="1.2 IMapDocument 方法加载 Mxd 文档文件"></a>1.2 IMapDocument 方法加载 Mxd 文档文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">BtnIMapDocument_Click</span><span class="params">(object sender, EventArgs e)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">try</span></div><div class="line">    &#123;</div><div class="line">        OpenFileDialog pOpenFileDialog = <span class="keyword">new</span> OpenFileDialog();</div><div class="line">        pOpenFileDialog.CheckFileExists = <span class="keyword">true</span>;</div><div class="line">        pOpenFileDialog.Title = <span class="string">"打开地图文档"</span>;</div><div class="line">        pOpenFileDialog.Filter = <span class="string">"ArcMap文档(*.mxd)|*.mxd;|ArcMap模板(*.mxt)|*.mxt|发布地图文件(*.pmf)|*.pmf|所有地图格式(*.mxd;*.mxt;*.pmf)|*.mxd;*.mxt;*.pmf"</span>;</div><div class="line">        pOpenFileDialog.Multiselect = <span class="keyword">false</span>;</div><div class="line">        pOpenFileDialog.RestoreDirectory = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">if</span> (pOpenFileDialog.ShowDialog() == DialogResult.OK)</div><div class="line">        &#123;</div><div class="line">            string pFileName = pOpenFileDialog.FileName;</div><div class="line">            <span class="keyword">if</span> (pFileName == <span class="string">""</span>)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (mainMapControl.CheckMxFile(pFileName)) <span class="comment">//检查地图文档有效性</span></div><div class="line">            &#123;</div><div class="line">                <span class="comment">//将数据载入pMapDocument并与Map控件关联</span></div><div class="line">                IMapDocument pMapDocument = <span class="keyword">new</span> MapDocument();<span class="comment">//using ESRI.ArcGIS.Carto;</span></div><div class="line">                pMapDocument.Open(pFileName, <span class="string">""</span>);</div><div class="line">                <span class="comment">//获取Map中激活的地图文档</span></div><div class="line">                mainMapControl.Map = pMapDocument.ActiveView.FocusMap;</div><div class="line">                mainMapControl.ActiveView.Refresh();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span></div><div class="line">            &#123;</div><div class="line">                MessageBox.Show(pFileName + <span class="string">"是无效的地图文档!"</span>, <span class="string">"信息提示"</span>);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">catch</span> (Exception ex)</div><div class="line">    &#123;</div><div class="line">        MessageBox.Show(<span class="string">"打开地图文档失败"</span> + ex.Message);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="1-3-ControlsOpenDocCommandClass-加载地图"><a href="#1-3-ControlsOpenDocCommandClass-加载地图" class="headerlink" title="1.3 ControlsOpenDocCommandClass 加载地图"></a>1.3 ControlsOpenDocCommandClass 加载地图</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">BtncontrolsOpenDocCommandClass_Click</span><span class="params">(object sender, EventArgs e)</span></span></div><div class="line">&#123;</div><div class="line">    ICommand command = <span class="keyword">new</span> ControlsOpenDocCommandClass();</div><div class="line">    command.OnCreate(mainMapControl.Object);</div><div class="line">    command.OnClick();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-加载-Shapefile-数据"><a href="#2-加载-Shapefile-数据" class="headerlink" title="2. 加载 Shapefile 数据"></a>2. 加载 Shapefile 数据</h3><p>加载 Shapefile 数据的方式有两种：</p>
<ul>
<li>(1) 通过工作空间加载；</li>
<li>(2) 通过 MapControl 空间的 AddShapefile 方法加载</li>
</ul>
<h4 id="2-1-通过工作空间加载"><a href="#2-1-通过工作空间加载" class="headerlink" title="2.1 通过工作空间加载"></a>2.1 通过工作空间加载</h4><p><strong>实例程序实现思路：</strong></p>
<ul>
<li>(1) 创建 ShapefileWorkspaceFactory 实例 pWorkspaceFactory ，使用 IWorkspaceFactory 接口的 OpenFromFile 方法打开 pFeatureWorkspace 中存储的基于 Shapefile 的工作区。</li>
<li>(2) 创建 FeatureLayer 的实例 pFeatureLayer ，并定义数据集。</li>
<li>(3) 使用 IMap 接口的 AddLayer 方法加载 pFeatureLayer 到当前地图。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddShp_Click</span><span class="params">(object sender, EventArgs e)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//ClearAllData();</span></div><div class="line">    <span class="keyword">try</span></div><div class="line">    &#123;</div><div class="line">        OpenFileDialog pOpenFileDialog = <span class="keyword">new</span> OpenFileDialog();</div><div class="line">        pOpenFileDialog.CheckFileExists = <span class="keyword">true</span>;</div><div class="line">        pOpenFileDialog.Title = <span class="string">"打开Shape文件"</span>;</div><div class="line">        pOpenFileDialog.Filter = <span class="string">"Shape文件（*.shp）|*.shp"</span>;</div><div class="line">        pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">        <span class="comment">////获取文件路径,此即为第二种方法</span></div><div class="line">        <span class="comment">//FileInfo pFileInfo = new FileInfo(pOpenFileDialog.FileName);</span></div><div class="line">        <span class="comment">//string pPath = pOpenFileDialog.FileName.Substring(0, pOpenFileDialog.FileName.Length - pFileInfo.Name.Length);</span></div><div class="line">        <span class="comment">//mainMapControl.AddShapeFile(pPath, pFileInfo.Name);</span></div><div class="line"></div><div class="line">        <span class="comment">// 获取文件路径</span></div><div class="line">        IWorkspaceFactory pWorkspaceFactory;</div><div class="line">        IFeatureWorkspace pFeatureWorkspace;</div><div class="line">        IFeatureLayer pFeatureLayer;</div><div class="line"></div><div class="line">        string pFullPath = pOpenFileDialog.FileName;</div><div class="line">        <span class="keyword">if</span> (pFullPath == <span class="string">""</span>)</div><div class="line">            <span class="keyword">return</span>;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> pIndex = pFullPath.LastIndexOf(<span class="string">"\\"</span>);</div><div class="line">        <span class="comment">//lastIndexOf是从字符串末尾开始检索，检索到子字符，则返回子字符在字符串中的位置，（位置从前向后数，最小位为0，也就是从第0位开始算起）未检测到则返回-1。</span></div><div class="line">        string pFilePath = pFullPath.Substring(<span class="number">0</span>, pIndex); <span class="comment">//文件路径</span></div><div class="line">        string pFileName = pFullPath.Substring(pIndex + <span class="number">1</span>); <span class="comment">//文件名</span></div><div class="line">        <span class="comment">/*substring(参数)是java中截取字符串的一个方法</span></div><div class="line">        有两种传参方式</div><div class="line">        一种是 public String substring(int beginIndex)</div><div class="line">        返回一个新的字符串，它是此字符串的一个子字符串。该子字符串从指定索引处的字符开始，直到此字符串末尾。</div><div class="line">        另一种是 public String substring(int beginIndex, int endIndex)</div><div class="line">        返回一个新字符串，它是此字符串的一个子字符串。该子字符串从指定的 beginIndex 处开始，直到索引 endIndex - 1 处的字符。因此，该子字符串的长度为 endIndex-beginIndex。 */</div><div class="line"></div><div class="line">        <span class="comment">//实例化ShapefileWorkspaceFactory工作空间，打开Shape文件</span></div><div class="line">        pWorkspaceFactory = <span class="keyword">new</span> ShapefileWorkspaceFactory();</div><div class="line">        pFeatureWorkspace = (IFeatureWorkspace)pWorkspaceFactory.OpenFromFile(pFilePath, <span class="number">0</span>);</div><div class="line">        <span class="comment">//创建并实例化要素集</span></div><div class="line">        IFeatureClass pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName);</div><div class="line">        pFeatureLayer = <span class="keyword">new</span> FeatureLayer();</div><div class="line">        pFeatureLayer.FeatureClass = pFeatureClass;</div><div class="line">        pFeatureLayer.Name = pFeatureLayer.FeatureClass.AliasName;<span class="comment">//获取别名</span></div><div class="line"></div><div class="line">        ClearAllData();    <span class="comment">//新增删除数据</span></div><div class="line"></div><div class="line">        mainMapControl.Map.AddLayer(pFeatureLayer);<span class="comment">//加载图层</span></div><div class="line">        mainMapControl.ActiveView.Refresh();</div><div class="line">        <span class="comment">//同步鹰眼.可有可无</span></div><div class="line">        SynchronizeEagleEye();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">catch</span> (Exception ex)</div><div class="line">    &#123;</div><div class="line">        MessageBox.Show(<span class="string">"图层加载失败！"</span> + ex.Message);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-2-通过-MapControl-空间的-AddShapefile-方法加载"><a href="#2-2-通过-MapControl-空间的-AddShapefile-方法加载" class="headerlink" title="2.2 通过 MapControl 空间的 AddShapefile 方法加载"></a>2.2 通过 MapControl 空间的 AddShapefile 方法加载</h4><blockquote>
<p>调用该方法需要传入两个参数，分别是文件路径和不带扩展名的文件名。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddShp2_Click</span><span class="params">(object sender, EventArgs e)</span></span></div><div class="line">&#123;</div><div class="line">    OpenFileDialog pOpenFileDialog = <span class="keyword">new</span> OpenFileDialog();</div><div class="line">    pOpenFileDialog.CheckFileExists = <span class="keyword">true</span>;</div><div class="line">    pOpenFileDialog.Title = <span class="string">"打开Shape文件"</span>;</div><div class="line">    pOpenFileDialog.Filter = <span class="string">"Shape文件（*.shp）|*.shp"</span>;</div><div class="line">    pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">    <span class="comment">//获取文件路径</span></div><div class="line">    FileInfo pFileInfo = <span class="keyword">new</span> FileInfo(pOpenFileDialog.FileName);<span class="comment">//FileInfo需要using system.IO</span></div><div class="line">    string pPath = pOpenFileDialog.FileName.Substring(<span class="number">0</span>, pOpenFileDialog.FileName.Length - pFileInfo.Name.Length);</div><div class="line">    mainMapControl.AddShapeFile(pPath, pFileInfo.Name);</div><div class="line">    <span class="comment">// 调用该方法需要传入两个参数，分别是文件路径和不带扩展名的文件名。</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-加载栅格数据"><a href="#2-加载栅格数据" class="headerlink" title="2. 加载栅格数据"></a>2. 加载栅格数据</h3><p><strong>实例程序实现思路：</strong></p>
<p>在加载栅格文件时，需引用 ESRI.ArcGIS.DataSourcesRaster 命名空间。</p>
<ul>
<li>(1) 用 IWorkspaceFactory 接口的 OpenFromFile 方法获得栅格文件的工作区； </li>
<li>(2) 用 IRasterWorkspace 接口的 OpenRasterDataset 方法获得栅格文件的数据集，实例化栅格文件对象，并对栅格数据集是否具有金字塔进行判断（这里栅格文件如果不具有金字塔则创建金字塔，可以提高大数据量图像的显示效率）；</li>
<li>(3) 创建 RasterLayer 类的实例 pRasterLayer ，并定义其数据集；</li>
<li>(4) 使用 MapControl 控件的 AllLayer 方法将 pRasterLayer 添加至当前地图。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddRaster_Click</span><span class="params">(object sender, EventArgs e)</span></span></div><div class="line">&#123;</div><div class="line">    OpenFileDialog pOpenFileDialog = <span class="keyword">new</span> OpenFileDialog();</div><div class="line">    pOpenFileDialog.CheckFileExists = <span class="keyword">true</span>;</div><div class="line">    pOpenFileDialog.Title = <span class="string">"打开Raster文件"</span>;</div><div class="line">    pOpenFileDialog.Filter = <span class="string">"栅格文件 (*.*)|*.bmp;*.tif;*.jpg;*.img|(*.bmp)|*.bmp|(*.tif)|*.tif|(*.jpg)|*.jpg|(*.img)|*.img"</span>;</div><div class="line">    pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">    string pRasterFileName = pOpenFileDialog.FileName;</div><div class="line">    <span class="keyword">if</span> (pRasterFileName == <span class="string">""</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    string pPath = System.IO.Path.GetDirectoryName(pRasterFileName);</div><div class="line">    string pFileName = System.IO.Path.GetFileName(pRasterFileName);</div><div class="line"></div><div class="line">    IWorkspaceFactory pWorkspaceFactory = <span class="keyword">new</span> RasterWorkspaceFactory();</div><div class="line">    IWorkspace pWorkspace = pWorkspaceFactory.OpenFromFile(pPath, <span class="number">0</span>);</div><div class="line">    IRasterWorkspace pRasterWorkspace = pWorkspace as IRasterWorkspace;</div><div class="line">    IRasterDataset pRasterDataset = pRasterWorkspace.OpenRasterDataset(pFileName);</div><div class="line">    <span class="comment">//影像金字塔判断与创建</span></div><div class="line">    IRasterPyramid3 pRasPyrmid;</div><div class="line">    pRasPyrmid = pRasterDataset as IRasterPyramid3;</div><div class="line">    <span class="keyword">if</span> (pRasPyrmid != <span class="keyword">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (!(pRasPyrmid.Present))</div><div class="line">        &#123;</div><div class="line">            pRasPyrmid.Create(); <span class="comment">//创建金字塔</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    IRaster pRaster;</div><div class="line">    pRaster = pRasterDataset.CreateDefaultRaster();</div><div class="line">    IRasterLayer pRasterLayer;</div><div class="line">    pRasterLayer = <span class="keyword">new</span> RasterLayerClass();</div><div class="line">    pRasterLayer.CreateFromRaster(pRaster);</div><div class="line">    mainMapControl.Map.AddLayer(pLayer);<span class="comment">//加载shp文件时是这样弄得，经过尝试这样也是可以的，具体有什么区别不可知</span></div><div class="line">    <span class="comment">//mainMapControl.AddLayer(pLayer, 0);//这是书上的源代码</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-加载-CAD-数据"><a href="#3-加载-CAD-数据" class="headerlink" title="3. 加载 CAD 数据"></a>3. 加载 CAD 数据</h3><p>对于 ArcGIS Engine 来说，有两种不同的方式使用 CAD 数据：① 作为要素图层，以矢量数据来使用；② 作为地图背景，以栅格数据来使用。对于前者， ArcGIS Engine 使用与 FeatureLayer 一样的方法来管理，对于后者则采用 CadLayer 对象来管理。</p>
<h4 id="3-1-CAD-文件作为矢量图层加载"><a href="#3-1-CAD-文件作为矢量图层加载" class="headerlink" title="3.1 CAD 文件作为矢量图层加载"></a>3.1 CAD 文件作为矢量图层加载</h4><h5 id="3-1-1-分图层加载"><a href="#3-1-1-分图层加载" class="headerlink" title="3.1.1 分图层加载"></a>3.1.1 分图层加载</h5><p><strong>实例程序实现思路：</strong></p>
<ul>
<li>(1) CAD 图可以分为点、线、面、标注，它们可以分别被加载到 MapControl 中。与加载其他数据一样，首先定义一个工作空间，用 CadWorkspaceFactoryClass 实例化工作空间，并打开相应的工作空间； </li>
<li>(2) 创建 FeatureLayer 的实例，定义数据集，使用 IMap 接口的 AddLayer 方法将要素图层添加至当前地图。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddCADByLayer_Click</span><span class="params">(object sender, EventArgs e)</span></span></div><div class="line">&#123;</div><div class="line">    IWorkspaceFactory pWorkspaceFactory;</div><div class="line">    IFeatureWorkspace pFeatureWorkspace;</div><div class="line">    IFeatureLayer pFeatureLayer;</div><div class="line">    IFeatureClass pFeatureClass;</div><div class="line"></div><div class="line">    OpenFileDialog pOpenFileDialog = <span class="keyword">new</span> OpenFileDialog();</div><div class="line">    pOpenFileDialog.Filter = <span class="string">"CAD(*.dwg)|*.dwg"</span>;</div><div class="line">    pOpenFileDialog.Title = <span class="string">"打开CAD数据文件"</span>;</div><div class="line">    pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">    string pFullPath = pOpenFileDialog.FileName;</div><div class="line">    <span class="keyword">if</span> (pFullPath == <span class="string">""</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//获取文件名和文件路径</span></div><div class="line">    <span class="keyword">int</span> pIndex = pFullPath.LastIndexOf(<span class="string">"\\"</span>);</div><div class="line">    string pFilePath = pFullPath.Substring(<span class="number">0</span>, pIndex);</div><div class="line">    string pFileName = pFullPath.Substring(pIndex + <span class="number">1</span>);</div><div class="line"></div><div class="line">    pWorkspaceFactory = <span class="keyword">new</span> CadWorkspaceFactory();</div><div class="line">    pFeatureWorkspace = (IFeatureWorkspace)pWorkspaceFactory.OpenFromFile(pFilePath, <span class="number">0</span>);</div><div class="line">    <span class="comment">//加载CAD文件中的线文件</span></div><div class="line">    pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName + <span class="string">":polyline"</span>);</div><div class="line">    <span class="comment">//pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName + ":polygon");//打开多边形</span></div><div class="line">    <span class="comment">//pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName + ":point");//打开点</span></div><div class="line">    <span class="comment">//pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName + ":multipatch");//打开多面体</span></div><div class="line">    <span class="comment">//pFeatureClass = pFeatureWorkspace.OpenFeatureClass(pFileName + ":annotation");//打开标注是这样吗？自己尝试失败，打开的是点，什么鬼？搞不懂。。。</span></div><div class="line">    pFeatureLayer = <span class="keyword">new</span> FeatureLayerClass();</div><div class="line">    pFeatureLayer.Name = pFileName;</div><div class="line">    pFeatureLayer.FeatureClass = pFeatureClass;</div><div class="line"></div><div class="line">    ClearAllData();    <span class="comment">//新增删除数据</span></div><div class="line"></div><div class="line">    mainMapControl.Map.AddLayer(pFeatureLayer);</div><div class="line">    mainMapControl.ActiveView.Refresh();</div><div class="line">    <span class="comment">//同步鹰眼，可有可无</span></div><div class="line">    SynchronizeEagleEye();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="3-1-2-整幅图加载"><a href="#3-1-2-整幅图加载" class="headerlink" title="3.1.2 整幅图加载"></a>3.1.2 整幅图加载</h5><p><strong>实例程序实现思路：</strong></p>
<ul>
<li>将 CAD 作为整幅图加载时，在得到相应的工作空间之后对 CAD 文件中的要素进行遍历，并判断是否为注记图层，如果是注记则需要使用 CadAnnotationLayer 对象。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddWholeCAD_Click</span><span class="params">(object sender, EventArgs e)</span></span></div><div class="line">&#123;</div><div class="line">    IWorkspaceFactory pWorkspaceFactory;</div><div class="line">    IFeatureWorkspace pFeatureWorkspace;</div><div class="line">    IFeatureLayer pFeatureLayer;</div><div class="line">    IFeatureDataset pFeatureDataset;</div><div class="line"></div><div class="line">    OpenFileDialog pOpenFileDialog = <span class="keyword">new</span> OpenFileDialog();</div><div class="line">    pOpenFileDialog.Filter = <span class="string">"CAD(*.dwg)|*.dwg"</span>;</div><div class="line">    pOpenFileDialog.Title = <span class="string">"打开CAD数据文件"</span>;</div><div class="line">    pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">    string pFullPath = pOpenFileDialog.FileName;</div><div class="line">    <span class="keyword">if</span> (pFullPath == <span class="string">""</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//获取文件名和文件路径</span></div><div class="line">    <span class="keyword">int</span> pIndex = pFullPath.LastIndexOf(<span class="string">"\\"</span>);</div><div class="line">    string pFilePath = pFullPath.Substring(<span class="number">0</span>, pIndex);</div><div class="line">    string pFileName = pFullPath.Substring(pIndex + <span class="number">1</span>);</div><div class="line">    <span class="comment">//打开CAD数据集</span></div><div class="line">    pWorkspaceFactory = <span class="keyword">new</span> CadWorkspaceFactoryClass(); <span class="comment">//using ESRI.ArcGIS.DataSourcesFile;</span></div><div class="line">    pFeatureWorkspace = (IFeatureWorkspace)pWorkspaceFactory.OpenFromFile(pFilePath, <span class="number">0</span>);</div><div class="line">    <span class="comment">//打开一个要素集</span></div><div class="line">    pFeatureDataset = pFeatureWorkspace.OpenFeatureDataset(pFileName);</div><div class="line">    <span class="comment">//IFeatureClassContainer可以管理IFeatureDataset中的每个要素类</span></div><div class="line">    IFeatureClassContainer pFeatClassContainer = (IFeatureClassContainer)pFeatureDataset;</div><div class="line"></div><div class="line">    ClearAllData();    <span class="comment">//新增删除数据</span></div><div class="line"></div><div class="line">    <span class="comment">//对CAD文件中的要素进行遍历处理</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pFeatClassContainer.ClassCount; i++)</div><div class="line">    &#123;</div><div class="line">        IFeatureClass pFeatClass = pFeatClassContainer.get_Class(i);</div><div class="line">        <span class="comment">//如果是注记，则添加注记层</span></div><div class="line">        <span class="keyword">if</span> (pFeatClass.FeatureType == esriFeatureType.esriFTCoverageAnnotation)</div><div class="line">        &#123;</div><div class="line">            pFeatureLayer = <span class="keyword">new</span> CadAnnotationLayerClass();</div><div class="line">            pFeatureLayer.Name = pFeatClass.AliasName;</div><div class="line">            pFeatureLayer.FeatureClass = pFeatClass;</div><div class="line">            mainMapControl.Map.AddLayer(pFeatureLayer);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="comment">//如果是点、线、面则添加要素层</span></div><div class="line">        &#123;</div><div class="line">            pFeatureLayer = <span class="keyword">new</span> FeatureLayerClass();</div><div class="line">            pFeatureLayer.Name = pFeatClass.AliasName;</div><div class="line">            pFeatureLayer.FeatureClass = pFeatClass;</div><div class="line">            mainMapControl.Map.AddLayer(pFeatureLayer);</div><div class="line">        &#125;</div><div class="line">        mainMapControl.ActiveView.Refresh();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//同步鹰眼，可有可无</span></div><div class="line">    SynchronizeEagleEye();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-2-CAD-文件作为栅格图层加载"><a href="#3-2-CAD-文件作为栅格图层加载" class="headerlink" title="3.2 CAD 文件作为栅格图层加载"></a>3.2 CAD 文件作为栅格图层加载</h4><p><strong>实例程序实现思路：</strong></p>
<ul>
<li>(1) 用 IWorkspaceFactory 接口的 OpenFromFile 方法获得 CAD 文件的工作区； </li>
<li>(2) 用 ICadDrawingWorkspace 接口的 OpenCadDrawingDataset 方法获得 CAD 文件的数据集，并将其赋值给 CadLayerClass 类的实例对象 pCadLayer 的 CadDrawingDataset 属性；</li>
<li>(3) 使用 IMap 接口的 AddLayer 方法将 pCadLayer 添加至当前地图。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddRasterByCAD_Click</span><span class="params">(object sender, EventArgs e)</span></span></div><div class="line">&#123;</div><div class="line">    IWorkspaceFactory pCadWorkspaceFactory;</div><div class="line">    IWorkspace pWorkspace;</div><div class="line">    ICadDrawingWorkspace pCadDrawingWorkspace;</div><div class="line">    ICadDrawingDataset pCadDrawingDataset;</div><div class="line">    ICadLayer pCadLayer;</div><div class="line"></div><div class="line">    OpenFileDialog pOpenFileDialog = <span class="keyword">new</span> OpenFileDialog();</div><div class="line">    pOpenFileDialog.Filter = <span class="string">"CAD(*.dwg)|*.dwg"</span>;</div><div class="line">    pOpenFileDialog.Title = <span class="string">"打开CAD数据文件"</span>;</div><div class="line">    pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">    string pFullPath = pOpenFileDialog.FileName;</div><div class="line">    <span class="keyword">if</span> (pFullPath == <span class="string">""</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//获取文件名和文件路径</span></div><div class="line">    <span class="keyword">int</span> pIndex = pFullPath.LastIndexOf(<span class="string">"\\"</span>);</div><div class="line">    string pFilePath = pFullPath.Substring(<span class="number">0</span>, pIndex);</div><div class="line">    string pFileName = pFullPath.Substring(pIndex + <span class="number">1</span>);</div><div class="line">    pCadWorkspaceFactory = <span class="keyword">new</span> CadWorkspaceFactoryClass();</div><div class="line"></div><div class="line">    pWorkspace = pCadWorkspaceFactory.OpenFromFile(pFilePath, <span class="number">0</span>);</div><div class="line">    pCadDrawingWorkspace = (ICadDrawingWorkspace)pWorkspace;</div><div class="line">    <span class="comment">//获得CAD文件的数据集</span></div><div class="line">    pCadDrawingDataset = pCadDrawingWorkspace.OpenCadDrawingDataset(pFileName);</div><div class="line">    pCadLayer = <span class="keyword">new</span> CadLayerClass();</div><div class="line">    pCadLayer.CadDrawingDataset = pCadDrawingDataset;</div><div class="line">    pCadLayer.Name = pFileName;<span class="comment">//书中代码没有这一句，打开的结果是TOC面板里面没有文件的名字，故而自己添上了这一句</span></div><div class="line"></div><div class="line">    mainMapControl.Map.AddLayer(pCadLayer);</div><div class="line">    mainMapControl.ActiveView.Refresh();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-加载个人地理数据库"><a href="#4-加载个人地理数据库" class="headerlink" title="4. 加载个人地理数据库"></a>4. 加载个人地理数据库</h3><p><strong>实例程序实现思路：</strong></p>
<ul>
<li>(1) 创建 AccessWorkspaceFactory 类的实例； </li>
<li>(2) 用 IWorkspaceFactory 接口的 OpenFromFile 方法打开 *.mdb 数据集的工作空间，对工作空间里面的数据进行加载。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddPersonGDB_Click</span><span class="params">(object sender, EventArgs e)</span></span></div><div class="line">&#123;</div><div class="line">    IWorkspaceFactory pAccessWorkspaceFactory;</div><div class="line"></div><div class="line">    OpenFileDialog pOpenFileDialog = <span class="keyword">new</span> OpenFileDialog();</div><div class="line">    pOpenFileDialog.Filter = <span class="string">"Personal Geodatabase(*.mdb)|*.mdb"</span>;</div><div class="line">    pOpenFileDialog.Title = <span class="string">"打开PersonGeodatabase文件"</span>;</div><div class="line">    pOpenFileDialog.ShowDialog();</div><div class="line"></div><div class="line">    string pFullPath = pOpenFileDialog.FileName;</div><div class="line">    <span class="keyword">if</span> (pFullPath == <span class="string">""</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    pAccessWorkspaceFactory = <span class="keyword">new</span> AccessWorkspaceFactory(); <span class="comment">//using ESRI.ArcGIS.DataSourcesGDB;</span></div><div class="line">    <span class="comment">//获取工作空间</span></div><div class="line">    IWorkspace pWorkspace = pAccessWorkspaceFactory.OpenFromFile(pFullPath, <span class="number">0</span>);</div><div class="line"></div><div class="line">    ClearAllData();    <span class="comment">//新增删除数据</span></div><div class="line"></div><div class="line">    <span class="comment">//加载工作空间里的数据</span></div><div class="line">    AddAllDataset(pWorkspace, mainMapControl);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>这里对加载工作空间中数据的方法进行了封装，自定义了 AddAllDataset 函数，以便对其他空间数据库（文件地理数据库、ArcSDE 空间数据库）加载时可直接调用。</li>
<li>以上代码主要介绍矢量和栅格数据的加载（其实不止这两种数据格式，加载其他类型的数据也是采用相同的方法，只是采用不同的工作空间而已）。</li>
<li>自定义函数 AddAllDataset 核心代码如下:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/// &lt;summary&gt;</span></div><div class="line"><span class="comment">/// 加载工作空间里面的要素和栅格数据</span></div><div class="line"><span class="comment">/// &lt;/summary&gt;</span></div><div class="line"><span class="comment">/// &lt;param name="pWorkspace"&gt;&lt;/param&gt;</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddAllDataset</span><span class="params">(IWorkspace pWorkspace, AxMapControl mapControl)</span></span></div><div class="line">&#123;</div><div class="line">    IEnumDataset pEnumDataset = pWorkspace.get_Datasets(ESRI.ArcGIS.Geodatabase.esriDatasetType.esriDTAny);</div><div class="line">    pEnumDataset.Reset();</div><div class="line">    <span class="comment">//将Enum数据集中的数据一个个读到DataSet中</span></div><div class="line">    IDataset pDataset = pEnumDataset.Next();</div><div class="line">    <span class="comment">//判断数据集是否有数据</span></div><div class="line">    <span class="keyword">while</span> (pDataset != <span class="keyword">null</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (pDataset is IFeatureDataset)  <span class="comment">//要素数据集</span></div><div class="line">        &#123;</div><div class="line">            IFeatureWorkspace pFeatureWorkspace = (IFeatureWorkspace)pWorkspace;</div><div class="line">            IFeatureDataset pFeatureDataset = pFeatureWorkspace.OpenFeatureDataset(pDataset.Name);</div><div class="line">            IEnumDataset pEnumDataset1 = pFeatureDataset.Subsets;</div><div class="line">            pEnumDataset1.Reset();</div><div class="line">            IGroupLayer pGroupLayer = <span class="keyword">new</span> GroupLayerClass();</div><div class="line">            pGroupLayer.Name = pFeatureDataset.Name;</div><div class="line">            IDataset pDataset1 = pEnumDataset1.Next();</div><div class="line">            <span class="keyword">while</span> (pDataset1 != <span class="keyword">null</span>)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">if</span> (pDataset1 is IFeatureClass)  <span class="comment">//要素类</span></div><div class="line">                &#123;</div><div class="line">                    IFeatureLayer pFeatureLayer = <span class="keyword">new</span> FeatureLayerClass();</div><div class="line">                    pFeatureLayer.FeatureClass = pFeatureWorkspace.OpenFeatureClass(pDataset1.Name);</div><div class="line">                    <span class="keyword">if</span> (pFeatureLayer.FeatureClass != <span class="keyword">null</span>)</div><div class="line">                    &#123;</div><div class="line">                        pFeatureLayer.Name = pFeatureLayer.FeatureClass.AliasName;</div><div class="line">                        pGroupLayer.Add(pFeatureLayer);</div><div class="line">                        mapControl.Map.AddLayer(pFeatureLayer);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                pDataset1 = pEnumDataset1.Next();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pDataset is IFeatureClass) <span class="comment">//要素类</span></div><div class="line">        &#123;</div><div class="line">            IFeatureWorkspace pFeatureWorkspace = (IFeatureWorkspace)pWorkspace;</div><div class="line">            IFeatureLayer pFeatureLayer = <span class="keyword">new</span> FeatureLayerClass();</div><div class="line">            pFeatureLayer.FeatureClass = pFeatureWorkspace.OpenFeatureClass(pDataset.Name);</div><div class="line"></div><div class="line">            pFeatureLayer.Name = pFeatureLayer.FeatureClass.AliasName;</div><div class="line">            mapControl.Map.AddLayer(pFeatureLayer);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pDataset is IRasterDataset) <span class="comment">//栅格数据集</span></div><div class="line">        &#123;</div><div class="line">            IRasterWorkspaceEx pRasterWorkspace = (IRasterWorkspaceEx)pWorkspace;</div><div class="line">            IRasterDataset pRasterDataset = pRasterWorkspace.OpenRasterDataset(pDataset.Name);</div><div class="line">            <span class="comment">//影像金字塔判断与创建</span></div><div class="line">            IRasterPyramid3 pRasPyrmid;</div><div class="line">            pRasPyrmid = pRasterDataset as IRasterPyramid3;</div><div class="line">            <span class="keyword">if</span> (pRasPyrmid != <span class="keyword">null</span>)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">if</span> (!(pRasPyrmid.Present))</div><div class="line">                &#123;</div><div class="line">                    pRasPyrmid.Create(); <span class="comment">//创建金字塔</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            IRasterLayer pRasterLayer = <span class="keyword">new</span> RasterLayerClass();</div><div class="line">            pRasterLayer.CreateFromDataset(pRasterDataset);</div><div class="line">            ILayer pLayer = pRasterLayer as ILayer;</div><div class="line">            mapControl.AddLayer(pLayer, <span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line">        pDataset = pEnumDataset.Next();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    mapControl.ActiveView.Refresh();</div><div class="line">    <span class="comment">//同步鹰眼</span></div><div class="line">    SynchronizeEagleEye();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> ArcGIS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ArcGIS </tag>
            
            <tag> AE </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hello World]]></title>
      <url>/2017/06/05/hello-world/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
      
        <categories>
            
            <category> hexo+github </category>
            
        </categories>
        
        
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
